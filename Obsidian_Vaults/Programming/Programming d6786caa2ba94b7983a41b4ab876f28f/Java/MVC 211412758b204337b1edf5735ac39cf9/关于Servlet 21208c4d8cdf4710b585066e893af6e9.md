# 关于Servlet

1. 继承关系
    
    |`javax.servlet.Servlet` 接口
    
    |——→|`javax.servlet.GenericServlet` 抽象类
    
          |——→|`javax.servlet.http.HttpServlet` **抽象** 子类
    
2. 相关方法
    1. `void init()` 初始化
    2. `void service(request,response)` 服务方法
        
        这个方法在 `javax.servlet.http.HttpServlet` 中才不是抽象的。
        
        在这个方法中，将请求的方法如 `post` `get` 等分类并调用相关的执行方法
        
        - `service` 源码（简化过）
            
            ```java
            protected void service(HttpServletRequest req, HttpServletResponse resp)
                    throws ServletException, IOException
                {
                    String method = req.getMethod();
            
                    if (method.equals(METHOD_GET)) {
                            doGet(req, resp);
                    } else if (method.equals(METHOD_HEAD)) {
                        doHead(req, resp);
            
                    } else if (method.equals(METHOD_POST)) {
                        doPost(req, resp);
                        
                    } else if (method.equals(METHOD_PUT)) {
                        doPut(req, resp);
                        
                    } else if (method.equals(METHOD_DELETE)) {
                        doDelete(req, resp);
                        
                    } else if (method.equals(METHOD_OPTIONS)) {
                        doOptions(req,resp);
                        
                    } else if (method.equals(METHOD_TRACE)) {
                        doTrace(req,resp);
                        
                    } else {
                        //...
                }
            ```
            
        
        默认的 `doXxx` 方法是直接返回错误信息，所有不重写的话就报 `405` 错误。
        
    3. `void destory()` 销毁方法
3.  `Servlet` 的生命周期
    1. 默认情况：
        1. 第一次接受请求的时候，这个 `Servlet` 会实例化 `init()` 
        2. 后面每一次请求都是在调用 `service()` 
        3. 在 `tomcat` 关闭的时候，调用 `destory()`
        4. 也就是说，从始至终都只有一个 `servlet` 实例在响应，同时如果一次访问都没有的话就 **不会** 实例化 `servlet`
    2. 手动控制 `Servlet` 的实例化时机
        1. 在 `web.xml` 中的 `servlet` 标签加上 `<load-on-startup>` 来设置启动先后顺序
            
            ```xml
            <servlet>
                    <servlet-name>AddServlet</servlet-name>
                    <servlet-class>com.example.servletdemo.AddServlet</servlet-class>
            				<load-on-startup>1</load-on-startup>
            </servlet>
            ```
            
        2. 当然在注解中也可以设置（两者都可）：
            1. `@WebServlet(name = "addServlet", value = "/add" ,loadOnStartup = 1)`
            2. `@WebSerblet("/add")`
    3. `servlet` 在容器中是 **单例的**（用一个实例处理所有请求） 和 **线程不安全的**
        1. 所以，不要修改 `servlet` 类中成员变量的值
        2. 不要根据成员变量的值，做逻辑判断