# 连接数据库

## **要素一：Driver接口实现类**

### **Driver接口介绍**

- `java.sql.Driver` 接口是所有 JDBC 驱动程序需要实现的接口。这个接口是提供给数据库厂商使用的，不同数据库厂商提供不同的实现。
- 在程序中不需要直接去访问实现了 Driver 接口的类，而是由驱动程序管理器类(`java.sql.DriverManager`)去调用这些Driver实现。
    - Oracle的驱动：**`oracle.jdbc.driver.OracleDriver`**
    - mySQL的驱动： **`com.mysql.jdbc.Driver`**
        - `MySQL` 的官方驱动下载：[http://dev.mysql.com/downloads/connector/j/](http://dev.mysql.com/downloads/connector/j/)
- 将驱动的 `jar` 文件丢到 lib 文件夹里面就可
- 或者在 `maven` 中添加依赖
    
    ```xml
    <dependency>
         <groupId>mysql</groupId>
         <artifactId>mysql-connector-java</artifactId>
         <version>8.0.26</version>
    </dependency>
    ```
    

## **要素二：URL**

- JDBC URL 用于标识一个被注册的驱动程序，驱动程序管理器通过这个 URL 选择正确的驱动程序，从而建立到数据库的连接。
- JDBC URL的标准由三部分组成，各部分间用冒号分隔。
- **jdbc:子协议:子名称**
- **协议**：JDBC URL中的协议总是jdbc
- **子协议**：子协议用于标识一个数据库驱动程序
- **子名称**：一种标识数据库的方法。子名称可以依不同的子协议而变化，用子名称的目的是为了**定位数据库**提供足够的信息。包含**主机名**(对应服务端的ip地址)**，端口号，数据库名**

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/Java/JDBC%205a293e40988e49098409f3d58da691f4/连接数据库%20d696f901292d47be94ff049fd22254da/Untitled.png)

- **几种常用数据库的 JDBC URL**
    - MySQL的连接URL编写方式：
        - jdbc:mysql://主机名称:mysql服务端口号/数据库名称?参数=值&参数=值
        - `jdbc:mysql://localhost:3306/test？useSSL=false&serverTimezone=UTC`
        - jdbc:mysql://localhost:3306/atguigu**?useUnicode=true&characterEncoding=utf8**（如果JDBC程序与服务器端的字符集不一致，会导致乱码，那么可以通过参数指定服务器端的字符集）
        - jdbc:mysql://localhost:3306/atguigu?user=root&password=123456
    - Oracle 9i的连接URL编写方式：
        - jdbc:oracle:thin:@主机名称:oracle服务端口号:数据库名称
        - jdbc:oracle:thin:@localhost:1521:atguigu
    - SQLServer的连接URL编写方式：
        - jdbc:sqlserver://主机名称:sqlserver服务端口号:DatabaseName=数据库名称
        - jdbc:sqlserver://localhost:1433:DatabaseName=atguigu
    
    ### 连接方式：
    
    **方式一：**
    
    ```java
    import java.sql.*;
    import java.util.Properties;
    
    import org.junit.Test;
    
    public class ConnectionTest {
        static final String JDBC_DRIVER = "com.mysql.cj.jdbc.Driver";
        static final String DB_URL = "jdbc:mysql://localhost:3306/atguigudb?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC";
    
        static final String USER = "root";
        static final String PASS = "Suxton2817";
    
        @Test
        public void connectionTest1() throws SQLException, ClassNotFoundException {
    
    //        Class.forName(JDBC_DRIVER);
            //注册 driver
            Driver diver = new com.mysql.cj.jdbc.Driver();
    
            String url = "jdbc:mysql://localhost:3306/atguigudb?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC";
            Properties info = new Properties();
            //设置登录条件
            info.setProperty("user","root");
            info.setProperty("password","Suxton2817");
            //连接
            Connection conn = diver.connect(url, info);
            System.out.println(conn);
    
        }
    }
    ```
    
    **方式二：方式一的迭代**
    
    ```java
    @Test
        //没有出现第三方的api，使程序有更好的可移植性
        public void connectionTest2() throws Exception {
            //使用反射获取 driver 类
            Class<?> clazz = Class.forName("com.mysql.cj.jdbc.Driver");
            Driver driver = (Driver) clazz.newInstance();
            //接下来的是一样的
            String url = "jdbc:mysql://localhost:3306/atguigudb?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC";
            Properties info = new Properties();
            //设置登录条件
            info.setProperty("user","root");
            info.setProperty("password","Suxton2817");
            //连接
            Connection conn = driver.connect(url, info);
            System.out.println(conn);
        }
    ```
    
    **方式三：**使用 `DriverManager` 替换 `Driver`
    
    ```java
    @Test
        public void connectionTest3() throws Exception {
            //使用反射获取 driver 类对象
            Class<?> clazz = Class.forName("com.mysql.cj.jdbc.Driver");
            Driver driver = (Driver) clazz.newInstance();
            //提供基本信息
            String url = "jdbc:mysql://localhost:3306/atguigudb?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC";
            String user = "root";
            String password = "Suxton2817";
    
            DriverManager.registerDriver(driver);
            //连接
            Connection conn = DriverManager.getConnection(url, user, password);
    
            System.out.println(conn);
        }
    ```
    
    **方式四：用 `MySQL` 驱动中的静态方法注册，不用手动注册**
    
    ```java
    public void connectionTest4() throws Exception {
            //其实这个也可以省略， MySQL的驱动会自动导入
            Class.forName("com.mysql.cj.jdbc.Driver");
          /*  在加载 MySQL 驱动的时候会自动运行这段代码，将注册操作完成
               下面是驱动中的具体实现
          static {
                try {
                    DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());
                } catch (SQLException var1) {
                    throw new RuntimeException("Can't register driver!");
                }
            }*/
            //提供基本信息
            String url = "jdbc:mysql://localhost:3306/atguigudb?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC";
            String user = "root";
            String password = "Suxton2817";
    
            //连接
            Connection conn = DriverManager.getConnection(url, user, password);
    
            System.out.println(conn);
        }
    ```
    
    **方式五（推荐）：将信息写到配置文件中**
    
    **用 `maven` 构建项目的时候配置文件要放在 `resources` 文件夹下！！！，如果是普通工程的话放在 `src` 文件夹下就行。**
    
    实现代码与数据的分离，修改配置信息的话不需要对文件重新打包
    
    ```java
    @Test
        public void connectionTest5() throws Exception {
            //读取配置信息，注意，用maven构建项目的时候配置文件要放在 resources 文件夹下！！！
            InputStream is = ConnectionTest.class.getClassLoader().getResourceAsStream("jdbc.properties");
    
            Properties pros = new Properties();
            pros.load(is);
    
            //从配置文件读取字段
            String url = pros.getProperty("url");
            String user = pros.getProperty("user");
            String password = pros.getProperty("password");
            String driverClass = pros.getProperty("driverClass");
            //System.out.println(url+' '+user+' '+password+' '+driverClass);
            //加载驱动
            Class.forName(driverClass);
            //获取连接
            Connection conn = DriverManager.getConnection(url, user, password);
    
            System.out.println(conn);
        }
    ```