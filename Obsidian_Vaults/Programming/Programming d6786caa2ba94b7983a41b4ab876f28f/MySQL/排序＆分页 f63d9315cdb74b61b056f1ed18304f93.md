# 排序＆分页

# 排序

如果没有使用排序的操作，默认的顺序是将条目加入到数据库的顺序。

```sql
mysql> select first_name,salary from employees order by salary;#用order by字段排序，默认升序
+-------------+----------+
| first_name  | salary   |
+-------------+----------+
| TJ          |  2100.00 |
| Steven      |  2200.00 |
| Steven      | 24000.00 |
+-------------+----------+
3 rows in set (0.01 sec)
```

### 排序规则

- 使用 ORDER BY 子句排序
    - `ASC（ascend）`: 升序
    - `DESC（descend）`:降序 —>
        - `select first_name,salary from employees order by salary **DESC**;`
- ORDER BY 子句在SELECT语句的结尾。

**注意：** 列的别名只能再 `ORDER BY` 中去使用，不能在 `WHERE` 中使用！因为SQL最开始查询的是`FROM`后面的内容，先定位到表，然后看 `WHERE` 。再看 `SELECT` 中有几个需要展示的列，最后才看 `ORDER BY` 里面关于排序的内容。

**二级排序**： 

如果第一列数据中所有值都是唯一的，将不再对第二列进行排序。

```sql
mysql> select employee_id,salary,department_id
    -> from employees
    -> order by department_id desc,salary asc;#再部门id降序的同时，保证工资升序
+-------------+----------+---------------+
| employee_id | salary   | department_id |
+-------------+----------+---------------+
|         206 |  8300.00 |           110 |
|         205 | 12000.00 |           110 |
|         113 |  6900.00 |           100 |
|         111 |  7700.00 |           100 |
|         200 |  4400.00 |            10 |
|         178 |  7000.00 |          NULL |
+-------------+----------+---------------+
6 rows in set (0.00 sec)

```

# 分页

分页的好处是 SELECT 不需要扫描完整的表，只需要检索到一条符合条件的记录即可返回。

### **使用方法：** `LIMIT [偏移量,] 行数`

具体来说： `LIMIT (pageNum -1) * pageSize, pageSize;`

```sql
mysql> select employee_id ,last_name
    -> from employees
    -> LIMIT 0,4;#第一页
+-------------+-----------+
| employee_id | last_name |
+-------------+-----------+
|           1 | h_hh      |
|         100 | King      |
|         101 | Kochhar   |
|         102 | De Haan   |
+-------------+-----------+
4 rows in set (0.00 sec)

mysql> select employee_id ,last_name
    -> from employees
    -> LIMIT 4,4;#用偏移量来控制页数
+-------------+-----------+
| employee_id | last_name |
+-------------+-----------+
|         103 | Hunold    |
|         104 | Ernst     |
|         105 | Austin    |
|         106 | Pataballa |
+-------------+-----------+
4 rows in set (0.00 sec)
```

### 摆放位置

```sql
mysql> select employee_id ,last_name
    -> from employees
    -> where salary>6000
    -> order by salary desc
    -> limit 4;
+-------------+-----------+
| employee_id | last_name |
+-------------+-----------+
|         100 | King      |
|         101 | Kochhar   |
|         102 | De Haan   |
|         145 | Russell   |
+-------------+-----------+
4 rows in set (0.00 sec)
```

### MySQL8.0新特性

**使用方法：** `LIMIT 行数 offset 偏移数`

具体来说： `LIMIT pageSize offset (pageNum -1) * pageSize;`

```sql
mysql> select employee_id ,last_name
    -> from employees
    -> where salary>6000
    -> order by salary desc
    -> limit 4 offset 0;
+-------------+-----------+
| employee_id | last_name |
+-------------+-----------+
|         100 | King      |
|         101 | Kochhar   |
|         102 | De Haan   |
|         145 | Russell   |
+-------------+-----------+
4 rows in set (0.00 sec)
```

### SQL分页操作的兼容性

1. 与`MySQL`一样的：在 `MySQL`、`PostgreSQL`、`MariaDB` 和 `SQLite` 中使用 `LIMIT` 关
键字，而且需要放到 `SELECT` 语句的最后面。
2. 微软的骚操作 `SQL Sever` & `Access` ，使用 `TOP` 关键字
    
    `SELECT TOP 5 name, hp_max FROM heros ORDER BY hp_max DESC`
    
3. 神奇的IBM → `DB2` 使用 `FETCH FIRST n ROWS ONLY`
    
    `SELECT name, hp_max FROM heros ORDER BY hp_max DESC FETCH FIRST 5 ROWS ONLY`
    
4. 如果是 `Oracle`，你需要基于 `ROWNUM` 来统计行数：
    
    `SELECT rownum,last_name,salary FROM employees WHERE rownum < 5 ORDER BY salary DESC;`