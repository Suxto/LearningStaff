# 单行函数

**函数分类：** 单行函数，聚合函数。

# 数值函数

## 基本函数

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/MySQL/单行函数%20b97b1fe6db094b5fb897c08a9f3895cb/Untitled.png)

```sql
mysql> select truncate(129.222,-1);#注意，这个函数可以传入负数，但是依旧会保留所有整数位。
+----------------------+
| truncate(129.222,-1) |
+----------------------+
|                  120 |
+----------------------+
1 row in set (0.00 sec)
```

## 角度&弧度互换

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/MySQL/单行函数%20b97b1fe6db094b5fb897c08a9f3895cb/Untitled%201.png)

## 三角函数

**注意：** 输入变量应该是 **弧度** 

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/MySQL/单行函数%20b97b1fe6db094b5fb897c08a9f3895cb/Untitled%202.png)

## 指数&对数

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/MySQL/单行函数%20b97b1fe6db094b5fb897c08a9f3895cb/Untitled%203.png)

## 进制转换

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/MySQL/单行函数%20b97b1fe6db094b5fb897c08a9f3895cb/Untitled%204.png)

```sql
mysql> SELECT BIN(10),HEX(10),OCT(10),CONV(10,2,8)
    -> FROM DUAL;
+---------+---------+---------+--------------+
| BIN(10) | HEX(10) | OCT(10) | CONV(10,2,8) |
+---------+---------+---------+--------------+
| 1010    | A       | 12      | 2            |
+---------+---------+---------+--------------+
1 row in set (0.00 sec)
```

# 字符串函数

![Untitled](Programming/Programming%20d6786caa2ba94b7983a41b4ab876f28f/MySQL/单行函数%20b97b1fe6db094b5fb897c08a9f3895cb/Untitled%205.png)

![Untitled](Untitled%206.png)

![Untitled](Untitled%207.png)

![Untitled](Untitled%208.png)

### 注意事项：

1. 在 `MySQL` 中，字符串的起始索引是 `1` 
2. 在 `char_length()` 中，返回的值是字符的个数，也就是字符串的长度
3. 在 `length()` 中返回的是字符串在内存中占多少个字节

# 日期&时间

## 获得日期&时间

![Untitled](Untitled%209.png)

```sql
mysql> SELECT
    -> CURDATE(),CURTIME(),NOW(),SYSDATE()+0,UTC_DATE(),UTC_DATE()+0,UTC_TIME(),UTC_TIME()+0
    -> FROM DUAL;
+------------+-----------+---------------------+----------------+------------+--------------+------------+--------------+
| CURDATE()  | CURTIME() | NOW()               | SYSDATE()+0    | UTC_DATE() | UTC_DATE()+0 | UTC_TIME() | UTC_TIME()+0 |
+------------+-----------+---------------------+----------------+------------+--------------+------------+--------------+
| 2022-03-31 | 13:03:35  | 2022-03-31 13:03:35 | 20220331130335 | 2022-03-31 |     20220331 | 05:03:35   |        50335 |
+------------+-----------+---------------------+----------------+------------+--------------+------------+--------------+
1 row in set (0.00 sec)
```

## 日期&时间戳的转换

![Untitled](Untitled%2010.png)

```sql
mysql> SELECT UNIX_TIMESTAMP('2022-03-31 13:09:11');
+---------------------------------------+
| UNIX_TIMESTAMP('2022-03-31 13:09:11') |
+---------------------------------------+
|                            1648703351 |
+---------------------------------------+
1 row in set (0.00 sec)

mysql> select from_unixtime(1648703351);
+---------------------------+
| from_unixtime(1648703351) |
+---------------------------+
| 2022-03-31 13:09:11       |
+---------------------------+
1 row in set (0.00 sec)
```

## 获取月份、星期、星期数、天数等函数

![Untitled](Untitled%2011.png)

```sql
mysql> SELECT YEAR(CURDATE()),MONTH(CURDATE()),DAY(CURDATE()),
    -> HOUR(CURTIME()),MINUTE(NOW()),SECOND(SYSDATE())
    -> FROM DUAL;
+-----------------+------------------+----------------+-----------------+---------------+-------------------+
| YEAR(CURDATE()) | MONTH(CURDATE()) | DAY(CURDATE()) | HOUR(CURTIME()) | MINUTE(NOW()) | SECOND(SYSDATE()) |
+-----------------+------------------+----------------+-----------------+---------------+-------------------+
|            2022 |                3 |             31 |              13 |            15 |                37 |
+-----------------+------------------+----------------+-----------------+---------------+-------------------+
1 row in set (0.00 sec)

mysql> SELECT MONTHNAME('2022-03-31'),DAYNAME('2022-03-31'),WEEKDAY('2022-03-31'),
    -> QUARTER(CURDATE()),WEEK(CURDATE()),DAYOFYEAR(NOW()),
    -> DAYOFMONTH(NOW()),DAYOFWEEK(NOW())
    -> FROM DUAL;
+-------------------------+-----------------------+-----------------------+--------------------+-----------------+------------------+-------------------+------------------+
| MONTHNAME('2022-03-31') | DAYNAME('2022-03-31') | WEEKDAY('2022-03-31') | QUARTER(CURDATE()) | WEEK(CURDATE()) | DAYOFYEAR(NOW()) | DAYOFMONTH(NOW()) | DAYOFWEEK(NOW()) |
+-------------------------+-----------------------+-----------------------+--------------------+-----------------+------------------+-------------------+------------------+
| March                   | Thursday              |                     3 |                  1 |              13 |               90 |                31 |                5 |
+-------------------------+-----------------------+-----------------------+--------------------+-----------------+------------------+-------------------+------------------+
1 row in set (0.00 sec)

```

## 日期操作函数

![Untitled](Untitled%2012.png)

给 `EXTRACT()` 传不同的参数就能得到不同的效果）

```sql
mysql> select extract(minute from now()), extract(year_month from now()) from dual;
+----------------------------+--------------------------------+
| extract(minute from now()) | extract(year_month from now()) |
+----------------------------+--------------------------------+
|                         25 |                         202203 |
+----------------------------+--------------------------------+
1 row in set (0.00 sec)
```

## 时间&秒数转换

![Untitled](Untitled%2013.png)

```sql
mysql> select time_to_sec(sysdate()),sec_to_time(time_to_sec(sysdate()));
+------------------------+-------------------------------------+
| time_to_sec(sysdate()) | sec_to_time(time_to_sec(sysdate())) |
+------------------------+-------------------------------------+
|                  48608 | 13:30:08                            |
+------------------------+-------------------------------------+
1 row in set (0.00 sec)
```

## 日期&时间的计算

![Untitled](Untitled%2014.png)

其实 ADD 里面的 `expr` 可以填入负值，就完全替代了 SUB 的功能

```sql
mysql> select now(),date_add(now(),interval 1 year),date_add(now(),interval -1 year);
+---------------------+---------------------------------+----------------------------------+
| now()               | date_add(now(),interval 1 year) | date_add(now(),interval -1 year) |
+---------------------+---------------------------------+----------------------------------+
| 2022-03-31 13:54:15 | 2023-03-31 13:54:15             | 2021-03-31 13:54:15              |
+---------------------+---------------------------------+----------------------------------+
1 row in set (0.00 sec)

mysql> select now(),date_add(now(),interval '1_1' minute_second);
+---------------------+----------------------------------------------+
| now()               | date_add(now(),interval '1_1' minute_second) |
+---------------------+----------------------------------------------+
| 2022-03-31 14:02:38 | 2022-03-31 14:03:39                          |
+---------------------+----------------------------------------------+
1 row in set (0.00 sec)
```

**注意：** 当使用带下划线的参数时，应该用 `''` 。

![Untitled](Untitled%2015.png)

## 日期的格式化&解析

格式化：日期→字符串

解析：字符串→日期

![Untitled](Untitled%2016.png)

关于fmt参数

![Untitled](Untitled%2017.png)

```sql
#格式化：
mysql> select date_format(now(),'%Y-%m-%d %r %T');#这里面可以一直加符号
+-------------------------------------+
| date_format(now(),'%Y-%m-%d %r %T') |
+-------------------------------------+
| 2022-03-31 04:36:49 PM 16:36:49     |
+-------------------------------------+
1 row in set (0.00 sec)

#解析：
mysql> select str_to_date('2022-03-31 04:36:49 PM 16:36:49','%Y-%m-%d %r %T');
+-----------------------------------------------------------------+
| str_to_date('2022-03-31 04:36:49 PM 16:36:49','%Y-%m-%d %r %T') |
+-----------------------------------------------------------------+
| 2022-03-31 16:36:49                                             |
+-----------------------------------------------------------------+
1 row in set (0.00 sec)
```

关于 `GET_FORMAT` 函数中 `date_type` 和 `format_type` 参数

![Untitled](Untitled%2018.png)

```sql
mysql> select date_format(now(),get_format(date,'usa')),get_format(date,'usa');
+-------------------------------------------+------------------------+
| date_format(now(),get_format(date,'usa')) | get_format(date,'usa') |
+-------------------------------------------+------------------------+
| 03.31.2022                                | %m.%d.%Y               |
+-------------------------------------------+------------------------+
1 row in set (0.00 sec)
```

**注意**： 要把国家写到 `''` 里面！

## 流程控制函数

`MySQL`中的流程处理函数主要包括`IF()`、`IFNULL()`和`CASE()`函数。

![Untitled](Untitled%2019.png)

```sql
mysql> select last_name,salary,if(salary>6000,'hi','lo') "state" from employees limit 4;
+-----------+----------+-------+
| last_name | salary   | state |
+-----------+----------+-------+
| h_hh      |  2222.20 | lo    |
| King      | 24000.00 | hi    |
| Kochhar   | 17000.00 | hi    |
| De Haan   | 17000.00 | hi    |
+-----------+----------+-------+
4 rows in set (0.00 sec)

mysql> select last_name,salary,case when salary >=15000 then 'nb'
    -> when salary>=10000 then 'ke'
    -> else 'sb' end "datails"#如果没有else话，没有符合的结果的话返回的null
    -> from employees
    -> limit 5;
+-----------+----------+---------+
| last_name | salary   | datails |
+-----------+----------+---------+
| h_hh      |  2222.20 | sb      |
| King      | 24000.00 | nb      |
| Kochhar   | 17000.00 | nb      |
| De Haan   | 17000.00 | nb      |
| Hunold    |  9000.00 | sb      |
+-----------+----------+---------+
5 rows in set (0.00 sec)

mysql> select last_name,case department_id when 10 then 1.1 * salary
    -> when 20 then 1.2 * salary
    -> when 30 then 1.3*salary
    -> else salary*1.4 end "details" #记得加上end！
    -> from employees
    -> where department_id in (10,20,30)
    -> limit 4;
+-----------+----------+
| last_name | details  |
+-----------+----------+
| Whalen    |  4840.00 |
| Hartstein | 15600.00 |
| Fay       |  7200.00 |
| Raphaely  | 14300.00 |
+-----------+----------+
4 rows in set (0.00 sec)
```

## 加密&解密

![Untitled](Untitled%2020.png)

**注意： `passowrd()` 在 `MySQL8.0` 中，已经被弃用！**

```sql
#不可逆加密
mysql> select md5('hello'),sha('hello');
+----------------------------------+------------------------------------------+
| md5('hello')                     | sha('hello')                             |
+----------------------------------+------------------------------------------+
| 5d41402abc4b2a76b9719d911017c592 | aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d |
+----------------------------------+------------------------------------------+
1 row in set (0.00 sec)

#可逆加密
mysql> select encode('hello',233);
ERROR 1305 (42000): FUNCTION atguigudb.encode does not exist
```

**注意：** `encode()` 和 `decode()` 在 `MySQL8.0` 中也弃用了。

## 信息函数

![Untitled](Untitled%2021.png)

```sql
mysql> select version(),connection_id(),database(),user(),current_user(),charset('hello');
+-----------+-----------------+------------+----------------+----------------+------------------+
| version() | connection_id() | database() | user()         | current_user() | charset('hello') |
+-----------+-----------------+------------+----------------+----------------+------------------+
| 8.0.26    |               9 | atguigudb  | root@localhost | root@localhost | gbk              |
+-----------+-----------------+------------+----------------+----------------+------------------+
1 row in set (0.00 sec)
```

## 其他函数

![Untitled](Untitled%2022.png)

```sql
#给format()传入负数的n，当0处理
mysql> SELECT FORMAT(123.123, 2), FORMAT(123.523, 0), FORMAT(123.123, -2);
+--------------------+--------------------+---------------------+
| FORMAT(123.123, 2) | FORMAT(123.523, 0) | FORMAT(123.123, -2) |
+--------------------+--------------------+---------------------+
| 123.12             | 124                | 123                 |
+--------------------+--------------------+---------------------+
1 row in set (0.00 sec)

#计算方式为192乘以256的3次方，加上168乘以256的2次方，加上1乘以256，再加上1
mysql> SELECT INET_ATON('192.168.1.1'),inet_ntoa(3232235777);
+--------------------------+-----------------------+
| INET_ATON('192.168.1.1') | inet_ntoa(3232235777) |
+--------------------------+-----------------------+
|               3232235777 | 192.168.1.1           |
+--------------------------+-----------------------+
1 row in set (0.00 sec)

mysql> select benchmark(100000,md5('mysql'));
+--------------------------------+
| benchmark(100000,md5('mysql')) |
+--------------------------------+
|                              0 |
+--------------------------------+
1 row in set (0.01 sec)

mysql> SELECT CHARSET('mysql'), CHARSET(CONVERT('mysql' USING 'utf8'));
+------------------+----------------------------------------+
| CHARSET('mysql') | CHARSET(CONVERT('mysql' USING 'utf8')) |
+------------------+----------------------------------------+
| gbk              | utf8mb3                                |
+------------------+----------------------------------------+
1 row in set, 1 warning (0.00 sec)
```